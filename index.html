<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEMI-GETSANG</title>
    
    <link rel="stylesheet" href="styles/base.css"> 
    
    <link rel="stylesheet" href="header/header.css">
    <link rel="stylesheet" href="header/month-nav.css">
    <link rel="stylesheet" href="calendar/calendar.css">
    <link rel="stylesheet" href="bottom-bar/bottom-bar.css">
    <link rel="stylesheet" href="bottom-bar/my-calendar/my-calendar.css"> 
</head>
<body>
    <div class="web-container"> 
        <div id="header-container"></div>

        <div id="calendar-container"></div>

        <div id="bottom-bar-container"></div>
    </div>

    <div id="event-input-sheet" class="bottom-sheet">
        <div class="sheet-header">
            <span class="edit-icon" id="sheet-edit-icon">📝</span>
            <span class="date-display" id="sheet-date-display">새 일정 추가</span>
            <span class="close-icon" onclick="toggleEventSheet(false)">❌</span>
        </div>
        <div class="sheet-content">
            <div id="event-input-form">
                <div class="input-group">
                    <label for="event-date">날짜 선택:</label>
                    <input type="date" id="event-date" value="2025-09-27">
                </div>

                <div class="input-group">
                    <label for="event-title">일정 내용:</label>
                    <input type="text" id="event-title" placeholder="일정 제목을 입력하세요">
                </div>

                <div class="input-group">
                    <label for="event-memo">메모 추가:</label>
                    <textarea id="event-memo" placeholder="여기에 내용을 입력하세요..." rows="3"></textarea>
                </div>

                <div class="input-group index-group">
                    <label>인덱스 (색상):</label>
                    <div class="selection-container" id="category-selection">
                        <span class="category-tag active" data-color="red" data-category="개인">개인</span>
                        <span class="category-tag" data-color="purple" data-category="휴가">휴가</span>
                        <span class="category-tag" data-color="green" data-category="사업단">사업단</span>
                        <span class="category-tag" data-color="blue" data-category="성장마루">성장마루</span>
                        <span class="category-tag" data-color="yellow" data-category="알바">알바</span>
                        <span class="category-tag" data-color="cyan" data-category="병원">병원</span>
                        <span class="add-btn" onclick="addCustomCategory()">+</span>
                    </div>
                </div>

                <div class="input-group icon-group">
                    <label>아이콘:</label>
                    <div class="selection-container" id="icon-selection">
                        <span class="icon-option active" data-icon="📝">📝</span>
                        <span class="icon-option" data-icon="🧑‍💻">🧑‍💻</span>
                        <span class="icon-option" data-icon="✏️">✏️</span>
                        <span class="icon-option" data-icon="❤️">❤️</span>
                        <span class="icon-option" data-icon="🎹">🎹</span>
                        <span class="icon-option" data-icon="⚽">⚽</span>
                        <span class="icon-option" data-icon="🏥">🏥</span>
                        <span class="add-btn" onclick="alert('새로운 아이콘 추가 기능은 개발 중입니다.')">+</span>
                    </div>
                </div>
                
                <button id="save-event-btn" onclick="saveEventLogic()">일정 저장</button>
            </div>
            
            <div id="event-details-list">
                <div class="event-item-placeholder">
                    <div class="event-icon">📝</div> 
                    <div class="event-details">
                        <span class="event-title">세미콜론 스터디 모임</span>
                        <span class="event-schedule">매주 토요일</span>
                        <span class="event-category">개인</span>
                    </div>
                    <span class="arrow-icon">&gt;</span>
                </div>
            </div>

            <p id="no-events-message" style="text-align: center; color: #888; display: none;">선택한 날짜에 일정이 없습니다.</p>
        </div>
    </div>

    <script src="header/header.js"></script>
    <script src="calendar/calendar.js"></script>
    <script src="calendar/schedule.js"></script> 
    <script src="bottom-bar/bottom-bar.js"></script>
    <script src="bottom-bar/my-calendar/my-calendar.js"></script> <script>
        document.addEventListener('DOMContentLoaded', async () => { 
            const loadComponent = async (path, containerId) => {
                try {
                    const response = await fetch(path);
                    const html = await response.text();
                    
                    if (containerId === 'header-container' && path === 'header/month-nav.html') {
                        document.getElementById(containerId).insertAdjacentHTML('beforeend', html);
                    } else {
                        document.getElementById(containerId).innerHTML = html;
                    }

                    if (containerId === 'calendar-container') {
                        if (window.initCalendar) {
                            window.initCalendar();
                        }
                    }
                } catch (error) {
                    console.error(`Error loading component from ${path}:`, error);
                }
            };

            // 컴포넌트 로드
            await loadComponent('header/header.html', 'header-container');
            await loadComponent('header/month-nav.html', 'header-container');
            await loadComponent('calendar/calendar.html', 'calendar-container');
            await loadComponent('bottom-bar/bottom-bar.html', 'bottom-bar-container');
            
            // ⭐ 통합된 로직의 초기화 함수만 호출 ⭐
            if (window.initTabHandler) {
                window.initTabHandler();
            }
            
            // 일정 입력 핸들러 초기화 함수 호출
            if (window.initInputHandlers) {
                window.initInputHandlers();
            }
        });

        // 바텀 시트 토글 함수
        window.toggleEventSheet = (show, mode = 'input') => {
            const sheet = document.getElementById('event-input-sheet');
            const form = document.getElementById('event-input-form');
            const list = document.getElementById('event-details-list');
            const sheetDateDisplay = document.getElementById('sheet-date-display');
            
            if (!sheet) return;
            
            sheet.classList.toggle('visible', show);

            if (show) {
                form.style.display = (mode === 'input') ? 'block' : 'none';
                list.style.display = (mode === 'details') ? 'block' : 'none';
                
                if (mode === 'input') {
                    sheetDateDisplay.textContent = '새 일정 추가';
                    
                    const displayDate = window.currentDate || new Date(2025, 8, 1);
                    const year = displayDate.getFullYear();
                    const month = displayDate.getMonth() + 1;
                    const day = displayDate.getDate();
                    const today = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    document.getElementById('event-date').value = today;
                    document.getElementById('event-title').value = ''; 
                }
            }
        };
        
        // 커스텀 로직: + 버튼 클릭 시 호출
        window.addCustomCategory = () => {
             alert("새로운 인덱스/색상 추가 기능은 개발 중입니다.");
        };

        // 일정 저장 버튼 클릭 시 호출 (my-calendar.js의 전역 함수를 호출)
        window.saveEvent = () => {
            if (window.saveEventLogic) {
                window.saveEventLogic();
            } else {
                 console.error("saveEventLogic is not defined.");
            }
        };
    </script>